name: Build and Deploy Docker

on:
  push:
    branches:
      - main
    tags:
      - 'v*.*.*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
  
      - name: Install qbec
        run: |
          curl -L https://github.com/splunk/qbec/releases/download/v0.15.2/qbec-darwin-amd64.tar.gz -o qbec.tar.gz
          la -la
          pwd
          tar -xzf qbec.tar.gz -C ./qbec qbec 
          rm qbec.tar.gz 
      - name: check qbec
        run: |
          cd ./qbec 
          ./qbec version
      - name: Deploy to Kubernetes
        run: |
          cd ./qbec
          kubectl cluster-info
          qbec apply ./qbec/web/components/website.jsonnet
