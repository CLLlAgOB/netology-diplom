name: Build and Deploy Docker

on:
  push:
    branches:
      - main
    tags:
      - 'v*.*.*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
  
      - name: Install qbec
        run: |
          mkdir bin
          cd bin
          curl -L https://github.com/splunk/qbec/releases/download/v0.15.2/qbec-linux-amd64.tar.gz -o qbec.tar.gz
          tar -xzf qbec.tar.gz qbec
          chmod +x ./qbec 
          ./qbec version
          mv ./qbec /usr/bin/qbec
      - name: Deploy to Kubernetes
        run: |
          kubectl cluster-info
          qbec apply ./qbec/web/components/website.jsonnet
